<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>70x30 Sticker Generator (Zone + Bin)</title>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
      margin-bottom: 12px;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    textarea {
      width: 100%;
      height: 170px;
      font-family: Consolas, monospace;
      font-size: 13px;
      padding: 8px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 16px;
      margin-right: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    #previewBtn { background:#007bff; color:#fff; }
    #downloadBtn { background:#28a745; color:#fff; }
    #message { margin-top: 8px; color:#d9534f; font-size: 13px; }

    .preview-area {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .sticker {
      width: 280px;  /* visual preview only */
      height: 120px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 6px;
      text-align: center;
    }
    .sticker-desc {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }
    .sticker-barcode {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 3px;
    }
    .sticker-zonebin {
      font-size: 11px;
    }
  </style>
</head>
<body>
  <h1>70mm Ã— 30mm Sticker Generator (Zone + Bin)</h1>
  <div class="container">
    <p>
      <strong>Input format:</strong><br>
      <code>DescriptionInternationalNumberZoneBin</code><br>
      Example:<br>
      <code>Jasper F801B (Xl) Multi Panel Trimming B4715065077213B02R05-030</code>
    </p>

    <textarea id="rawInput" placeholder="Paste your lines here..."></textarea>

    <div>
      <button id="previewBtn">Preview</button>
      <button id="downloadBtn">Download PDF</button>
    </div>
    <div id="message"></div>

    <div class="preview-area" id="previewArea"></div>
  </div>

<script>
  // Parse line into {description, intlCode, zone, bin}
  function parseLine(line) {
    line = line.trim();
    if (!line) return null;

    // Expect last part like B02R05-030  (zone + bin)
    const zoneBinMatch = line.match(/([A-Za-z]\d{2})(R\d{2}-\d{3})$/);
    if (!zoneBinMatch) return null;

    const zone = zoneBinMatch[1];
    const bin = zoneBinMatch[2];

    // Everything before zone is description + international digits
    const beforeZone = line.slice(0, zoneBinMatch.index).trim();

    // Take last block of digits in "beforeZone" as international number
    const codeMatch = beforeZone.match(/(.*?)(\d+)\s*$/);
    let description = '';
    let intlCode = '';

    if (codeMatch) {
      description = codeMatch[1].trim();
      intlCode = codeMatch[2].trim();
    } else {
      description = beforeZone;
      intlCode = '';
    }

    return { description, intlCode, zone, bin };
  }

  let parsedItems = [];

  function buildPreview() {
    const input = document.getElementById('rawInput').value;
    const lines = input.split(/\r?\n/);

    parsedItems = [];
    const previewArea = document.getElementById('previewArea');
    const msg = document.getElementById('message');
    previewArea.innerHTML = '';
    msg.textContent = '';

    lines.forEach((line) => {
      const item = parseLine(line);
      if (!item) return;
      parsedItems.push(item);

      const sticker = document.createElement('div');
      sticker.className = 'sticker';

      const descEl = document.createElement('div');
      descEl.className = 'sticker-desc';
      descEl.textContent = item.description;

      const codeEl = document.createElement('div');
      codeEl.className = 'sticker-barcode';
      codeEl.textContent = item.intlCode;

      const zoneBinEl = document.createElement('div');
      zoneBinEl.className = 'sticker-zonebin';
      zoneBinEl.textContent = item.zone + " " + item.bin;

      sticker.appendChild(descEl);
      sticker.appendChild(codeEl);
      sticker.appendChild(zoneBinEl);

      previewArea.appendChild(sticker);
    });

    if (!parsedItems.length) {
      msg.textContent = "No valid lines found. Check your input format.";
    } else {
      msg.textContent = "Preview generated for " + parsedItems.length + " stickers.";
    }
  }

  async function downloadPDF() {
    if (!parsedItems.length) {
      buildPreview();
      if (!parsedItems.length) return;
    }

    const msg = document.getElementById('message');
    msg.textContent = "Building PDF...";

    const { jsPDF } = window.jspdf;
    // 70mm x 30mm per sticker, landscape
    const doc = new jsPDF({
      orientation: "landscape",
      unit: "mm",
      format: [30, 70]
    });

    parsedItems.forEach((item, idx) => {
      if (idx > 0) doc.addPage();

      // Description (top, bold, big)
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(10);
      const descLines = doc.splitTextToSize(item.description, 60);
      doc.text(descLines, 35, 8, { align: "center" });

      // International number (bit bold)
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(8);
      doc.text(item.intlCode || "", 35, 16, { align: "center" });

      // Zone + Bin (small)
      doc.setFont("Helvetica", "normal");
      doc.setFontSize(7);
      doc.text(item.zone + " " + item.bin, 35, 23, { align: "center" });
    });

    doc.save("stickers_zone_70x30mm.pdf");
    msg.textContent = "PDF downloaded.";
  }

  document.getElementById('previewBtn').addEventListener('click', buildPreview);
  document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
</script>
</body>
</html>
